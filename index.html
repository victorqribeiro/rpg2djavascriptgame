<!DOCTYPE=html>
<html>
<head><title>Hero</title>
</head>

<body>
<canvas id="mapa" width="512" height="512"></canvas>
<br>
<div id="caixa"></div>
<script>
window.requestAnimFrame = (function (callback) {
    return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function (callback) {
        window.setTimeout(callback, 1000 / 60);
    };
})();

var canvas = document.getElementById("mapa");
var c = canvas.getContext("2d");
var cW = cH = 512;
var pX = pY = pT = 64;
var posX;
var posY;
var sD = 0;
var sA = 0;
var heroi = new Image();
heroi.src = "img/heroi.png";
var cenario1 = new Image();
cenario1.src = "img/sprites.jpg";
var cenario;
var lvl = 1;
var mapa = [];
var mapaCol = [];
var moedas = [];

var mapa1 = [
    [0, 1, 1, 1, 1, 1, 1, 2],
    [7, 8, 8, 8, 8, 8, 11, 3],
    [7, 8, 8, 8, 8, 8, 8, 3],
    [7, 14, 8, 8, 8, 8, 8, 3],
    [7, 8, 8, 8, 8, 8, 8, 3],
    [7, 8, 11, 8, 8, 8, 13, 3],
    [7, 8, 8, 14, 8, 8, 15, 9],
    [6, 5, 5, 5, 5, 5, 5, 4]
];
var mapa2 = [
    [0, 1, 1, 1, 1, 1, 1, 2],
    [7, 13, 8, 8, 8, 8, 12, 3],
    [7, 8, 8, 15, 8, 8, 8, 3],
    [7, 8, 8, 4, 6, 8, 8, 3],
    [7, 14, 8, 2, 0, 8, 8, 3],
    [7, 8, 8, 8, 8, 8, 8, 3],
    [10, 8, 8, 8, 8, 8, 11, 3],
    [6, 5, 5, 5, 5, 5, 5, 4]
];

var mapaCol1 = [
    [1, 1, 1, 1, 1, 1, 1, 1],
    [1, 0, 0, 0, 0, 0, 0, 1],
    [1, 0, 0, 0, 0, 0, 0, 1],
    [1, 0, 0, 0, 0, 0, 0, 1],
    [1, 0, 0, 0, 0, 0, 0, 1],
    [1, 0, 0, 0, 0, 0, 4, 1],
    [1, 0, 0, 0, 0, 0, 4, 2],
    [1, 1, 1, 1, 1, 1, 1, 1]
];
var mapaCol2 = [
    [1, 1, 1, 1, 1, 1, 1, 1],
    [1, 4, 0, 0, 0, 0, 3, 1],
    [1, 0, 0, 4, 0, 0, 0, 1],
    [1, 0, 0, 1, 1, 0, 0, 1],
    [1, 0, 0, 1, 1, 0, 0, 1],
    [1, 0, 0, 0, 0, 0, 0, 1],
    [2, 0, 0, 0, 0, 0, 0, 1],
    [1, 1, 1, 1, 1, 1, 1, 1]
];

function andar(){
    sA += 64;
    if (sA == 192) {
        sA = 0;
    }
}

document.onkeydown = function (e) {
    e = e || window.event;
    var charCode = e.charCode || e.keyCode;
    
    num = moedas.length;
    
    if (charCode == 37 || charCode == 65) {
        andar();
        sD = 64;
        if (mapaCol[pY / pT][pX / pT - 1] != 1) {
            pX -= pT;
        }
    }
    if (charCode == 38 || charCode == 87) {
        andar();
        sD = 192;
        if (mapaCol[pY / pT - 1][pX / pT] != 1) {
            pY -= pT;
        }
    }
    if (charCode == 39 || charCode == 68) {
        andar();
        sD = 128;
        if (mapaCol[pY / pT][pX / pT + 1] != 1) {
            pX += pT;
        }
    }
    if (charCode == 40 || charCode == 83) {
        andar();
        sD = 0;
        if (mapaCol[pY / pT + 1][pX / pT] != 1) {
            pY += pT;
        }
    }

};


function init() {
    mapa = mapa1;
    mapaCol = mapaCol1;
    cenario = cenario1;
    anim();
}

function anim() {
    draw();
    requestAnimFrame(function () {
        anim();
    });
}

function draw() {
    c.clearRect(0, 0, cW, cH);
    for (var i = 0; i < mapa.length; i++) {
        for (var j = 0; j < mapa[i].length; j++) {
            if (mapa[j][i] == 0) {
                posX = 0;
                posY = 0;
            } else if (mapa[j][i] == 1) {
                posX = pT;
                posY = 0;
            } else if (mapa[j][i] == 2) {
                posX = pT * 2;
                posY = 0;
            } else if (mapa[j][i] == 3) {
                posX = pT * 2;
                posY = pT;
            } else if (mapa[j][i] == 4) {
                posX = pT * 2;
                posY = pT * 2;
            } else if (mapa[j][i] == 5) {
                posX = pT;
                posY = pT * 2;
            } else if (mapa[j][i] == 6) {
                posX = 0;
                posY = pT * 2;
            } else if (mapa[j][i] == 7) {
                posX = 0;
                posY = pT;
            } else if (mapa[j][i] == 8) {
                posX = pT;
                posY = pT;
            } else if (mapa[j][i] == 9) {
                posX = pT * 3;
                posY = 0;
            } else if (mapa[j][i] == 10) {
                posX = pT * 3;
                posY = pT;
            } else if (mapa[j][i] == 11) {
                posX = pT * 3;
                posY = pT * 2;
            } else if (mapa[j][i] == 12) {
                posX = pT * 3;
                posY = pT * 3;
            } else if (mapa[j][i] == 13) {
                posX = pT * 2;
                posY = pT * 3;
            } else if (mapa[j][i] == 14) {
                posX = pT;
                posY = pT * 3;
            } else if (mapa[j][i] == 15) {
                posX = 0;
                posY = pT * 3;
            }

            c.drawImage(cenario, posX, posY, pT, pT, i * pT, j * pT, pT, pT);
            if (mapaCol[pY / pT][pX / pT] == 2) {
                if (lvl == 1) {
                    mapa = mapa2;
                    mapaCol = mapaCol2;
                    pX = 64;
                    lvl = 2;
                } else if (lvl == 2) {
                    mapa = mapa1;
                    mapaCol = mapaCol1;
                    pX = 384;
                    lvl = 1;
                }
            } else if (mapaCol[pY / pT][pX / pT] == 3) {
                c.font = '30pt Arial';
                c.fillStyle = 'white';
                c.fillText('Você conseguiu ' + moedas.length + ' moedas!', 25, 250);
            } else if (mapaCol[pY / pT][pX / pT] == 4) {
                move = true;
                if (mapa[pY / pT][pX / pT] != 8) {
                    moedas[num] = 1;
                }
                mapa[pY / pT][pX / pT] = 8;
            }
        }

        c.drawImage(heroi, sA, sD, pT, pT, pX, pY, pT, pT);
    }

}

init();
</script>
</body>
<html>
